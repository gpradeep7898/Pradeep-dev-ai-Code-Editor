/* MyIDE v3 – Dark theme with purple accent */
:root {
  --bg:       #0d0e11;
  --bg-panel: #13141a;
  --bg-surf:  #1a1b22;
  --bg-hover: #22232d;
  --bg-act:   #2a2b38;
  --accent:   #7c6ff7;
  --acc-lt:   #a89ef9;
  --acc-dim:  #3d3875;
  --green:    #4ade80;
  --red:      #f87171;
  --yellow:   #facc15;
  --t1:       #e4e4ef;
  --t2:       #a0a0b8;
  --t3:       #5a5a7a;
  --border:   #22232e;
  --bord-lt:  #2e2f3e;
  --fc:       'JetBrains Mono', 'Menlo', monospace;
  --fu:       'Inter', system-ui, sans-serif;
  --r:        6px;
  --tbh:      42px;
  --swid:     240px;
  --cwid:     340px;
  --termh:    220px;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html, body { height: 100%; overflow: hidden; }
body { font-family: var(--fu); font-size: 13px; background: var(--bg); color: var(--t1); line-height: 1.5; }
button { cursor: pointer; border: none; background: none; font-family: inherit; font-size: inherit; color: inherit; }
input, textarea, select { font-family: inherit; font-size: inherit; color: inherit; background: none; border: none; outline: none; }
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--bord-lt); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--t3); }

/* ── TITLEBAR ─────────────────────────────────────────────────────────────── */
#titlebar {
  height: var(--tbh); background: var(--bg-panel); border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 10px; gap: 8px; user-select: none; flex-shrink: 0;
}
#tb-left, #tb-right { display: flex; align-items: center; gap: 4px; }
#tb-center { flex: 1; text-align: center; overflow: hidden; }
#logo { font-weight: 700; font-size: 14px; color: var(--acc-lt); letter-spacing: .5px; margin-right: 4px; }
#active-file-path { font-family: var(--fc); font-size: 11px; color: var(--t3); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.tb-btn {
  display: flex; align-items: center; gap: 5px; padding: 4px 10px;
  border-radius: var(--r); color: var(--t2); font-size: 12px; white-space: nowrap; transition: background .14s, color .14s;
}
.tb-btn:hover { background: var(--bg-hover); color: var(--t1); }
#ollama-status {
  display: flex; align-items: center; gap: 5px; padding: 3px 10px;
  background: var(--bg-surf); border-radius: 20px; font-size: 11px; color: var(--t2); margin-right: 4px;
}
.status-dot { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; }
.status-dot.online  { background: var(--green); box-shadow: 0 0 6px var(--green); }
.status-dot.offline { background: var(--t3); }
.status-dot.loading { background: var(--yellow); animation: pulse 1s ease-in-out infinite; }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }

/* ── WORKSPACE ────────────────────────────────────────────────────────────── */
#workspace {
  display: grid;
  grid-template-columns: var(--swid) 4px 1fr 4px var(--cwid);
  height: calc(100vh - var(--tbh));
  overflow: hidden;
}

/* ── RESIZERS ─────────────────────────────────────────────────────────────── */
.v-resizer { width: 4px; background: var(--border); cursor: col-resize; z-index: 10; transition: background .14s; }
.h-resizer { height: 4px; background: var(--border); cursor: row-resize; z-index: 10; transition: background .14s; }
.v-resizer:hover, .h-resizer:hover,
.v-resizer.drag, .h-resizer.drag { background: var(--accent); }

/* ── SHARED ───────────────────────────────────────────────────────────────── */
.panel-hdr {
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 10px; height: 34px; border-bottom: 1px solid var(--border); flex-shrink: 0;
}
.panel-title { font-size: 10px; font-weight: 600; letter-spacing: 1.2px; color: var(--t3); text-transform: uppercase; }
.panel-acts  { display: flex; gap: 2px; align-items: center; }
.icon-btn {
  width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;
  border-radius: 4px; color: var(--t3); font-size: 13px; transition: background .12s, color .12s;
}
.icon-btn:hover { background: var(--bg-hover); color: var(--t1); }

/* ── SIDEBAR ──────────────────────────────────────────────────────────────── */
#sidebar {
  background: var(--bg-panel); border-right: 1px solid var(--border);
  display: flex; flex-direction: column; overflow: hidden;
}
#ws-path {
  font-family: var(--fc); font-size: 10px; color: var(--t3);
  padding: 5px 10px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
  border-bottom: 1px solid var(--border); flex-shrink: 0;
}
#file-tree { flex: 1; overflow-y: auto; overflow-x: hidden; padding: 4px 0; }
.tree-empty { padding: 20px 14px; color: var(--t3); font-size: 12px; }
.tree-item {
  display: flex; align-items: center; gap: 6px; padding: 3px 6px;
  cursor: pointer; border-radius: 4px; margin: 0 4px; transition: background .1s; user-select: none;
}
.tree-item:hover { background: var(--bg-hover); }
.tree-item.sel   { background: var(--bg-act); color: var(--acc-lt); }
.tree-icon { font-size: 11px; color: var(--t3); flex-shrink: 0; width: 14px; text-align: center; transition: transform .15s; }
.tree-item.open > .tree-icon { transform: rotate(90deg); }
.tree-name { font-size: 13px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.tree-item.folder > .tree-name { color: var(--t1); }
.tree-item.file   > .tree-name { color: var(--t2); }
.tree-children    { padding-left: 14px; }
/* ext colours */
.tree-item[data-ext="js"]   .tree-name,
.tree-item[data-ext="mjs"]  .tree-name { color: #f0db4f; }
.tree-item[data-ext="ts"]   .tree-name { color: #3178c6; }
.tree-item[data-ext="tsx"]  .tree-name,
.tree-item[data-ext="jsx"]  .tree-name { color: #61dafb; }
.tree-item[data-ext="py"]   .tree-name { color: #4ec9b0; }
.tree-item[data-ext="json"] .tree-name { color: #e8c97e; }
.tree-item[data-ext="md"]   .tree-name { color: #a3c4f3; }
.tree-item[data-ext="css"]  .tree-name,
.tree-item[data-ext="scss"] .tree-name { color: #ce9bc4; }
.tree-item[data-ext="html"] .tree-name { color: #e34c26; }
.tree-item[data-ext="go"]   .tree-name { color: #79d4fd; }
.tree-item[data-ext="rs"]   .tree-name { color: #dea584; }
.tree-item[data-ext="sh"]   .tree-name { color: #89e051; }

/* ── MAIN AREA ────────────────────────────────────────────────────────────── */
#main-area {
  display: grid;
  grid-template-rows: 34px 1fr 4px var(--termh);
  overflow: hidden; background: var(--bg); min-width: 0;
}
#main-area.term-hidden { grid-template-rows: 34px 1fr 0 0; }

/* Tabs */
#tab-bar {
  display: flex; align-items: center; background: var(--bg-panel);
  border-bottom: 1px solid var(--border); overflow: hidden;
}
#tab-list {
  display: flex; align-items: stretch; overflow-x: auto; overflow-y: hidden; flex: 1;
  scrollbar-width: none;
}
#tab-list::-webkit-scrollbar { display: none; }
.tab {
  display: flex; align-items: center; gap: 6px; padding: 0 14px; height: 34px;
  cursor: pointer; border-right: 1px solid var(--border); color: var(--t3);
  font-size: 12px; font-family: var(--fc); transition: background .1s, color .1s;
  white-space: nowrap; flex-shrink: 0; max-width: 180px; position: relative;
}
.tab:hover  { background: var(--bg-hover); color: var(--t2); }
.tab.active { background: var(--bg); color: var(--t1); border-bottom: 2px solid var(--accent); }
.tab.dirty .tab-name::after { content: ' ●'; color: var(--accent); font-size: 10px; }
.tab-name { overflow: hidden; text-overflow: ellipsis; }
.tab-x { font-size: 11px; color: var(--t3); padding: 1px 3px; border-radius: 3px; }
.tab:hover .tab-x { color: var(--t2); }
.tab-x:hover { background: var(--bg-hover); color: var(--t1); }

/* Editor */
#editor-wrap { position: relative; overflow: hidden; }
#editor-placeholder {
  position: absolute; inset: 0; display: flex; flex-direction: column;
  align-items: center; justify-content: center; gap: 8px; pointer-events: none;
}
#editor-placeholder.hidden { display: none; }
.ph-icon  { font-size: 38px; color: var(--t3); }
.ph-title { font-size: 18px; font-weight: 600; color: var(--t2); }
.ph-sub   { font-size: 13px; color: var(--t3); }
#monaco-editor { width: 100%; height: 100%; }

/* Terminal */
#terminal-panel {
  background: var(--bg-panel); border-top: 1px solid var(--border);
  display: flex; flex-direction: column; overflow: hidden;
}
#terminal-panel.term-collapsed { display: none; }
#terminal-container { flex: 1; overflow: hidden; padding: 4px 6px; }
#terminal-container .xterm          { height: 100%; }
#terminal-container .xterm-viewport { background: transparent !important; }

/* ── AI PANEL ─────────────────────────────────────────────────────────────── */
#ai-panel {
  background: var(--bg-panel); border-left: 1px solid var(--border);
  display: flex; flex-direction: column; overflow: hidden; min-width: 0;
}
#model-switcher { display: flex; gap: 4px; padding: 8px; border-bottom: 1px solid var(--border); }
.model-btn {
  flex: 1; display: flex; align-items: center; gap: 7px; padding: 7px 8px;
  border-radius: var(--r); border: 1px solid var(--bord-lt); background: var(--bg-surf);
  color: var(--t2); transition: all .14s; cursor: pointer;
}
.model-btn:hover { border-color: var(--acc-dim); color: var(--t1); }
.model-btn.active { border-color: var(--accent); background: rgba(124,111,247,.1); color: var(--acc-lt); }
.m-icon { font-size: 14px; flex-shrink: 0; }
.m-info { display: flex; flex-direction: column; min-width: 0; }
.m-name { font-size: 12px; font-weight: 600; white-space: nowrap; }
.m-sub  { font-size: 10px; color: var(--t3); white-space: nowrap; }
.model-btn.active .m-sub { color: var(--acc-dim); }

#ollama-model-row {
  display: flex; align-items: center; gap: 8px; padding: 6px 10px;
  border-bottom: 1px solid var(--border); font-size: 12px;
}
#ollama-model-row label { color: var(--t3); flex-shrink: 0; }
#ollamaModelSel {
  flex: 1; background: var(--bg-surf); border: 1px solid var(--bord-lt);
  border-radius: var(--r); padding: 3px 6px; color: var(--t1);
  font-family: var(--fc); font-size: 11px;
}
#ollama-model-row.hidden { display: none; }

#ctx-row { padding: 6px 10px; border-bottom: 1px solid var(--border); }
.toggle-lbl {
  display: flex; align-items: center; gap: 7px; cursor: pointer;
  color: var(--t2); font-size: 12px; user-select: none;
}
.toggle-lbl input[type="checkbox"] { width: 14px; height: 14px; accent-color: var(--accent); cursor: pointer; }

/* Messages */
#chat-messages {
  flex: 1; overflow-y: auto; padding: 12px;
  display: flex; flex-direction: column; gap: 14px;
}
.chat-welcome { text-align: center; padding: 30px 16px; color: var(--t2); }
.wl-logo  { font-size: 34px; color: var(--accent); margin-bottom: 10px; }
.chat-welcome p { font-size: 13px; line-height: 1.6; margin-bottom: 6px; }
.wl-hint  { color: var(--t3); font-size: 12px !important; }

.msg { display: flex; flex-direction: column; gap: 4px; }
.msg-role { font-size: 10px; font-weight: 600; letter-spacing: .8px; text-transform: uppercase; color: var(--t3); }
.msg.user .msg-role { color: var(--accent); }
.msg.ai   .msg-role { color: var(--green); }
.msg-body {
  background: var(--bg-surf); border-radius: var(--r); padding: 10px 12px;
  font-size: 13px; line-height: 1.65; color: var(--t1); border: 1px solid var(--border);
  word-break: break-word;
}
.msg.user .msg-body { background: rgba(124,111,247,.08); border-color: var(--acc-dim); white-space: pre-wrap; }
.msg.ai   .msg-body { white-space: normal; }

/* Streaming */
.streaming::after { content: '▌'; color: var(--accent); animation: blink .8s step-end infinite; }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }

/* Markdown */
.msg-body p               { margin-bottom: 8px; }
.msg-body p:last-child    { margin-bottom: 0; }
.msg-body ul, .msg-body ol{ margin: 6px 0 6px 18px; }
.msg-body li              { margin-bottom: 3px; }
.msg-body strong          { color: var(--t1); font-weight: 600; }
.msg-body em              { color: var(--acc-lt); }
.msg-body h1, .msg-body h2, .msg-body h3 { margin: 10px 0 6px; color: var(--t1); }
.msg-body code:not(pre code) {
  font-family: var(--fc); font-size: 12px; background: var(--bg-act);
  padding: 1px 5px; border-radius: 3px; color: var(--acc-lt);
}

/* Code blocks in chat */
.code-block { position: relative; margin: 8px 0; border-radius: var(--r); overflow: hidden; border: 1px solid var(--bord-lt); }
.code-hdr {
  display: flex; align-items: center; justify-content: space-between;
  background: var(--bg-act); padding: 4px 10px; font-size: 11px; color: var(--t3);
}
.code-lang { font-family: var(--fc); color: var(--acc-lt); }
.code-acts { display: flex; gap: 4px; }
.code-acts button {
  padding: 2px 8px; border-radius: 3px; background: var(--bg-hover);
  border: 1px solid var(--bord-lt); color: var(--t2); font-size: 10px; cursor: pointer; transition: all .12s;
}
.code-acts button:hover { background: var(--acc-dim); color: var(--t1); border-color: var(--accent); }
.code-block pre { margin: 0; background: #0d1117 !important; padding: 12px; overflow-x: auto; }
.code-block pre code { font-family: var(--fc); font-size: 12px; line-height: 1.6; background: transparent !important; padding: 0 !important; }

/* Thinking spinner */
.thinking {
  color: var(--t3); font-style: italic; font-size: 12px; padding: 6px 0;
  display: flex; align-items: center; gap: 8px;
}
.thinking::before {
  content: ''; width: 14px; height: 14px;
  border: 2px solid var(--bord-lt); border-top-color: var(--accent);
  border-radius: 50%; animation: spin .8s linear infinite; flex-shrink: 0;
}
@keyframes spin { to { transform: rotate(360deg); } }
.msg-error { color: var(--red); background: rgba(248,113,113,.06) !important; border-color: rgba(248,113,113,.2) !important; }

/* Chat input */
#chat-input-area { border-top: 1px solid var(--border); padding: 10px; flex-shrink: 0; }
#chat-input-wrap {
  display: flex; align-items: flex-end; gap: 6px;
  background: var(--bg-surf); border: 1px solid var(--bord-lt);
  border-radius: var(--r); padding: 8px 6px 8px 10px; transition: border-color .14s;
}
#chat-input-wrap:focus-within { border-color: var(--accent); }
#chat-input { flex: 1; resize: none; background: none; font-size: 13px; color: var(--t1); line-height: 1.5; max-height: 140px; overflow-y: auto; }
#chat-input::placeholder { color: var(--t3); }
#btn-send {
  width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;
  background: var(--accent); color: white; border-radius: 5px; flex-shrink: 0; transition: background .14s, transform .1s;
}
#btn-send:hover { background: var(--acc-lt); transform: scale(1.05); }
#btn-send:active { transform: scale(.96); }
#btn-send:disabled { opacity: .4; cursor: not-allowed; transform: none; }
#chat-footer { display: flex; justify-content: space-between; margin-top: 6px; font-size: 11px; color: var(--t3); }
#active-model-lbl { color: var(--acc-lt); font-weight: 500; }

/* ── MODAL ────────────────────────────────────────────────────────────────── */
#modal-overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,.65);
  display: flex; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(4px);
}
#modal-overlay.hidden { display: none; }
#modal-box {
  background: var(--bg-surf); border: 1px solid var(--bord-lt); border-radius: 10px;
  padding: 24px; width: 460px; max-width: 90vw; box-shadow: 0 20px 60px rgba(0,0,0,.5);
}
#modal-title  { font-size: 15px; font-weight: 600; margin-bottom: 14px; }
#modal-input {
  width: 100%; background: var(--bg); border: 1px solid var(--bord-lt);
  border-radius: var(--r); padding: 9px 12px; font-family: var(--fc); font-size: 13px; transition: border-color .14s;
}
#modal-input:focus { border-color: var(--accent); }
#modal-acts { display: flex; justify-content: flex-end; gap: 8px; margin-top: 14px; }
.btn-ghost   { padding: 7px 16px; border-radius: var(--r); color: var(--t2); background: var(--bg-hover); font-size: 13px; transition: all .12s; }
.btn-ghost:hover   { background: var(--bg-act); color: var(--t1); }
.btn-primary { padding: 7px 18px; border-radius: var(--r); background: var(--accent); color: white; font-size: 13px; font-weight: 500; transition: all .12s; }
.btn-primary:hover { background: var(--acc-lt); }

/* ── TOAST ────────────────────────────────────────────────────────────────── */
#toast {
  position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(16px);
  background: var(--bg-act); border: 1px solid var(--bord-lt); color: var(--t1);
  padding: 7px 18px; border-radius: 20px; font-size: 12px; opacity: 0; pointer-events: none;
  transition: all .24s ease; z-index: 2000; white-space: nowrap; box-shadow: 0 4px 20px rgba(0,0,0,.3);
}
#toast.show    { opacity: 1; transform: translateX(-50%) translateY(0); }
#toast.success { border-color: var(--green); color: var(--green); }
#toast.error   { border-color: var(--red);   color: var(--red);   }

.hidden { display: none !important; }
